<!--
  ~
  ~  Copyright (c) 2012-2016 "FlockData LLC"
  ~
  ~  This file is part of FlockData.
  ~
  ~  FlockData is free software: you can redistribute it and/or modify
  ~  it under the terms of the GNU General Public License as published by
  ~  the Free Software Foundation, either version 3 of the License, or
  ~  (at your option) any later version.
  ~
  ~  FlockData is distributed in the hope that it will be useful,
  ~  but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~  GNU General Public License for more details.
  ~
  ~  You should have received a copy of the GNU General Public License
  ~  along with FlockData.  If not, see <http://www.gnu.org/licenses/>.
  -->


<!-- Content Header (Page header) -->
<section class="content-header">
  <h1>
    Import
    <small>new data into your Fortress</small>
  </h1>
  <ol class="breadcrumb">
    <li><a ui-shref="welcome"><i class="fa fa-home"></i> Home</a></li>
    <li class="active">Import</li>
  </ol>
</section>

<!-- Main content -->
<section class="content">
  <div class="row">
    <div class="col-md-12">
      <div class="box">
        <div class="box-header">
          <h3 class="box-title">Edit Content Profile - {{contentProfile.documentType.name}}</h3>
          <div class="box-tools">
            <button type="button" class="close" aria-label="Close" ng-click="cancel()">
              <span aria-hidden="true">&times;</span></button>

          </div>
        </div>
        <!-- /.box-header -->
        <div class="box-body">
          <div class="row">
            <!--<div class="col-md-2"></div>-->
            <div class="col-md-2">
              <div class="form-group" style="width: 180px; margin: 10px">
                <label class="col-sm-4 control-label">Layout</label>
                <div class="col-sm-8">
                  <select ng-model="layout" ng-options="l.name for l in layouts"></select>
                </div>
              </div>
            </div>
            <div class="col-md-4 pull-right">
              <ul class="nav nav-pills">
                <li class="active"><a data-target="#structure" data-toggle="tab"><i class="fa fa-sitemap"></i>Structure</a></li>
                <li><a data-target="#json" data-toggle="tab"><i class="fa fa-edit"></i>Edit JSON</a></li>
              </ul>
            </div>
          </div>
          <div class="tab-content">
            <div id="structure" class="tab-pane fade active in">
              <div class="col-md-2">
                <label class="control-label">Create</label>
                <button id="coldef" class="btn btn-sm btn-block btn-default" ng-click="createNew($event)">Column Definition</button>
                <button id="tag" class="btn btn-sm btn-block btn-warning" draggable options="{opacity: .5,revert: true}" ng-click="createNew($event)">Tag</button>
                <button id="alias" class="btn btn-sm btn-block btn-info" draggable options="{opacity: .5,revert: true}">Alias</button>
                <button id="entity" class="btn btn-sm btn-block btn-primary" draggable droppable="buttonDrop" options="{opacity: .5,revert: true}">Entity Link</button>
                <label class="control-label">Columns</label>
                <div class="btn-toolbar" id="Columns">
                  <button id="{{key.name}}" class="btn btn-xs " ng-class="key.type==='tag' ? 'btn-warning' : 'btn-primary'" draggable options="{opacity: .5,revert: true}" style="margin: 2px;" ng-repeat="key in colDefs" ng-click="showColDef(key.name)">{{key.name}}</button>
                </div>
              </div>
              <div class="col-md-10" droppable="handleDrop">
                <cytoscape elements="profileGraph" layout="layout" styles="styles" selected-nodes="nodes" ng-height="280"></cytoscape>
              </div>
            </div>
            <div id="json" class="tab-pane fade">
              <div ng-jsoneditor="onEditorLoad" ng-model="contentProfile" options="editorOptions.tree" ng-height="280"></div>
            </div>
            <div id="upload" class="tab-pane fade"></div>
          </div>
          <div class="clearfix"></div>
        </div>
        <!-- /.box-body -->
        <div class="box-footer">
          <button class="btn btn-default"  ng-click="cancel()">Cancel</button>
          <div class="pull-right">
            <button class="btn btn-primary" ng-click="analyzeExternal()"><i class="fa fa-lg fa-edit"></i>&nbsp; Analyze CSV</button>
            <button class="btn btn-primary" ng-click="save()"><i class="fa fa-lg fa-save"></i>&nbsp; Save</button>
            <button class="btn btn-success" ng-click="validate()"><i class="fa fa-lg fa-play-circle"></i>&nbsp; Validate</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script type="text/ng-template" id="edit-element.html">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-label="Close" ng-click="cancel()">
      <span aria-hidden="true">&times;</span></button>
    <h4 class="modal-title">Edit Properties</h4>
  </div>
  <form name="coldefProperties" role="form" class="form-horizontal" ng-submit="ok(coldefProperties.$valid)" novalidate>
    <div class="modal-body">
      <uib-tabset class="nav-tabs-custom">
        <uib-tab heading="Main">
          <div class="form-group">
            <div class="col-sm-offset-3 col-sm-3">
              <div class="checkbox">
                <label>
                  <input type="checkbox" id="isTag" name="isTag" ng-model="elem.tag" ng-disabled="target"> <b>Tag</b>
                </label>
              </div>
            </div>
          </div>
          <div class="form-group">
            <label for="name" class="col-sm-3 control-label">Name: </label>
            <div class="col-sm-8">
              <textarea id="name" name="name" class="form-control" ng-model="elem.name" rows="1" autofocus></textarea>
            </div>
          </div>
          <div class="form-group">
            <label for="code" class="col-sm-3 control-label">Code: </label>
            <div class="col-sm-8">
              <textarea id="code" name="code" class="form-control" ng-model="elem.code" rows="1" required></textarea>
            </div>
          </div>
          <div class="form-group">
            <label for="label" class="col-sm-3 control-label">Label: </label>
            <div class="col-sm-8">
              <textarea id="label" name="label" class="form-control" ng-model="elem.label" rows="1" required></textarea>
            </div>
          </div>
          <div class="form-group">
            <label for="relationship" class="col-sm-3 control-label">Relationship: </label>
            <div class="col-sm-8">
              <textarea id="relationship" name="relationship" class="form-control" ng-model="elem.relationship" rows="1"></textarea>
            </div>
          </div>
          <div class="form-group">
            <label for="keyPrefix" class="col-sm-3 control-label">Key Prefix: </label>
            <div class="col-sm-8">
              <input type="text" id="keyPrefix" name="keyPrefix" class="form-control" ng-model="elem.keyPrefix">
            </div>
          </div>
          <div class="form-group">
            <label for="notFoundCode" class="col-sm-3 control-label">Not Found Code: </label>
            <div class="col-sm-8">
              <input type="text" id="notFoundCode" name="notFoundCode" class="form-control" ng-model="elem.notFoundCode">
            </div>
          </div>
          <div class="form-group">
            <div class="col-sm-offset-3 col-sm-3">
              <div class="checkbox">
                <label>
                  <input type="checkbox" id="mustExist" name="mustExist" ng-model="elem.mustExist"> Must Exist
                </label>
              </div>
            </div>
            <div class="col-sm-3">
              <div class="checkbox">
                <label>
                  <input type="checkbox" id="merge" name="merge" ng-model="elem.merge"> Merge
                </label>
              </div>
            </div>
            <div class="col-sm-3">
              <div class="checkbox">
                <label>
                  <input type="checkbox" id="reverse" name="reverse" ng-model="elem.reverse"> Reverse
                </label>
              </div>
            </div>
          </div>
        </uib-tab>
        <uib-tab heading="Relationships">
          <label>Properties: </label>
          <div class="form-group" ng-repeat="prop in elem.properties">
            <div class="col-sm-6 prop-col">
              <select id="prop.source" class="form-control" ng-model="prop.source" ng-options="c.name as c.name for c in coldefs">
                <option value='' disabled selected>Source</option>
              </select>
            </div>
            <div class="col-sm-6 prop-col">
              <div class="input-group">
                <input type="text" class="form-control" id="prop.target" name="prop.target" ng-model="prop.target" placeholder="Target">
                <span class="input-group-btn">
                  <button type="button" class="btn btn-primary btn-flat" ng-click="elem.properties.splice($index,1)" ng-show="!$last"><i class="fa fa-trash"></i></button>
                </span>
                <span class="input-group-btn">
                  <button type="button" class="btn btn-primary btn-flat" ng-click="elem.properties.push({})" ng-show="$last"><i class="fa fa-plus"></i></button>
                </span>
              </div>
            </div>
          </div>
          <br>
          <label>Rlx Properties: </label>
          <div class="form-group" ng-repeat="rprop in elem.rlxProperties">
            <div class="col-sm-6 prop-col">
              <select id="rprop.source" class="form-control" ng-model="rprop.source" ng-options="c.name as c.name for c in coldefs">
                <option value='' disabled selected>Source</option>
              </select>
            </div>
            <div class="col-sm-6 prop-col">
              <div class="input-group">
                <input type="text" class="form-control" id="rprop.target" name="rprop.target" ng-model="rprop.target" placeholder="Target">
                <span class="input-group-btn">
                  <button type="button" class="btn btn-primary btn-flat" ng-click="elem.rlxProperties.splice($index,1)" ng-show="!$last"><i class="fa fa-trash"></i></button>
                </span>
                <span class="input-group-btn">
                  <button type="button" class="btn btn-primary btn-flat" ng-click="elem.rlxProperties.push({})" ng-show="$last"><i class="fa fa-plus"></i></button>
                </span>
              </div>
            </div>
          </div>
        </uib-tab>
      </uib-tabset>
      <div class="center"><label>Connected to - {{active}}</label></div>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-default pull-left" ng-click="cancel('cancel')">Cancel</button>
      <button type="submit" class="btn btn-primary" ng-disabled="coldefProperties.$invalid"><i class="fa fa-bolt"></i>&nbsp; Ok</button>
    </div>
  </form>
</script>

<script type="text/ng-template" id="edit-coldef.html">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-label="Close" ng-click="cancel()">
      <span aria-hidden="true">&times;</span></button>
    <h4 class="modal-title">Edit Properties</h4>
  </div>
  <div class="modal-body">
    <div ng-jsoneditor="onEditorLoad" ng-model="coldef" options="editorOptions.tree" ng-height="300"></div>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-default pull-left" ng-click="cancel('cancel')">Cancel</button>
    <button type="submit" class="btn btn-primary" ng-click="ok(coldef)"><i class="fa fa-bolt"></i>&nbsp; Ok</button>
  </div>
</script>
